
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Processing data from a Cloud Object Storage &#8212; Lithops v2.5.3.dev0</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="File “chunking”" href="file_chunking.html" />
    <link rel="prev" title="Storage OS API Details" href="api_storage_os.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/lithops_logo_readme.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Lithops v2.5.3.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   What is Lithops?
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lithops Core
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="design.html">
   Architecture Design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="supported_clouds.html">
   Supported Clouds
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="comparing_lithops.html">
   Comparing Lithops with other distributed computing frameworks
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="execution_modes.html">
   Execution Modes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="mode_localhost.html">
     Localhost Execution Mode
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mode_serverless.html">
     Serverless Execution Mode
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mode_standalone.html">
     Standalone Execution Mode
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cli.html">
   Lithops Command Line Tool
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Install and configure Lithops
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install_lithops.html">
   Install Lithops
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="general_config.html">
   General Configuration
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="backends_config.html">
   Backends Configuration
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/aliyun_functions.html">
     Aliyun Function Compute
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/aws_lambda.html">
     AWS Lambda
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/azure_batch.html">
     Azure Batch (under development)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/azure_functions.html">
     Azure Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/code_engine.html">
     IBM Cloud Code Engine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/gcp_cloudrun.html">
     GCP Cloud Run
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/gcp_functions.html">
     GCP Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/ibm_cf.html">
     IBM Cloud Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/ibm_vpc.html">
     IBM Virtual Private Cloud
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/k8s_job.html">
     Kubernetes (batch/job)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/knative.html">
     Knative
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/localhost.html">
     Localhost
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/openwhisk.html">
     OpenWhisk
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="compute_config/vm.html">
     Virtual Machine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_config/aliyun_oss.html">
     Aliyun Object Storage Service
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_config/aws_s3.html">
     AWS S3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_config/azure_blob.html">
     Azure Blob Storage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_config/ceph.html">
     Ceph
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_config/gcp_storage.html">
     GCP Storage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_config/ibm_cos.html">
     IBM Cloud Object Storage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_config/infinispan.html">
     Infinispan
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_config/minio.html">
     MinIO
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_config/redis.html">
     Redis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_config/swift.html">
     Swift
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lithops Futures API
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="api_futures.html">
   Lithops Futures API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="notebooks/functions.html">
   Functions and Parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="notebooks/function_chaining.html">
   Function chaining
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Storage
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="api_storage.html">
   Lithops Storage API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="api_storage_os.html">
   Storage OS API Details
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data Processing
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Processing data from a Cloud Object Storage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="file_chunking.html">
   File “chunking”
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Experimental Features
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="api_multiprocessing.html">
   Multiprocessing API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="metrics.html">
   Prometheus Monitoring
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dso.html">
   Distributed shared objects across function activations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sklearn_joblib.html">
   Distributed Scikit-learn / Joblib
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Developer Guide
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="development.html">
   Development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="testing.html">
   Testing Guidelines
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/source/data_processing.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/lithops-cloud/lithops"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/lithops-cloud/lithops/issues/new?title=Issue%20on%20page%20%2Fsource/data_processing.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cloud-object-storage">
   Cloud Object Storage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#processing-data-from-public-urls">
   Processing data from public URLs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#processing-data-from-localhost-files">
   Processing data from localhost files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reducer-granularity">
   Reducer granularity
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="processing-data-from-a-cloud-object-storage">
<span id="data-processing"></span><h1>Processing data from a Cloud Object Storage<a class="headerlink" href="#processing-data-from-a-cloud-object-storage" title="Permalink to this headline">¶</a></h1>
<p>Lithops has built-in logic for processing data objects from public URLs and object storage services. This logic is automatically activated with the reseverd parameter named <strong>obj</strong>. When you write in the parameters of a function the parameter name <strong>obj</strong>, you are telling to Lithops that you want to process objects located in an object storage service, public urls, or localhost files.</p>
<p>Additionally, the built-in data-processing logic integrates a <strong>data partitioner</strong> system that allows to automatically split the dataset in smallest chunks. Splitting a file into smaller chunks permit to leverage the parallelism provided by the compute backends to process the data. We designed the partitioner within the <code class="docutils literal notranslate"><span class="pre">map()</span></code> and <code class="docutils literal notranslate"><span class="pre">map_reduce()</span></code> API calls, an it is configurable by specifying the <em>size of the chunk</em>, or the <em>number of chunks</em> to split each file. The current implementation of the data partitioner supports to split files that contain multiple lines (or rows) ended by ‘n’, for example, a .txt book or a common .csv file among others. More data-types will be supported in future releases.</p>
<div class="section" id="cloud-object-storage">
<h2>Cloud Object Storage<a class="headerlink" href="#cloud-object-storage" title="Permalink to this headline">¶</a></h2>
<p>For processing data from a cloud object storage service, the input data must be either a list of buckets, a list of buckets with object prefix, or a list of data objects. If you set the <em>size of the chunk</em> or the <em>number of chunks</em>, the partitioner is activated inside Lithops and it is responsible to split the objects into smaller chunks, eventually running one function activation for each generated chunk. If <em>size of the chunk</em> and <em>number of chunks</em> are not set, chunk is an entire object, so one function activation is executed for each individual object.</p>
<p>The <strong>obj</strong> parameter is a python class from where you can access all the information related to the object (or chunk) that the function is processing. For example, consider the following function that shows all the available attributes in <strong>obj</strong> when you are processing objects from an object store:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_map_function</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">bucket</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">part</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data_byte_range</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data_stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>The allowed inputs of a function can be:</p>
<ul class="simple">
<li><p>Input data is a bucket or a list of buckets. See an example in [map_reduce_cos_bucket.py](../../examples/map_reduce_cos_bucket.py):</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iterdata</span> <span class="o">=</span> <span class="s1">&#39;bucket1&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Input data is a bucket(s) with object prefix. See an example in [map_cos_prefix.py](../../examples/map_cos_prefix.py):</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iterdata</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bucket1/images/&#39;</span><span class="p">,</span> <span class="s1">&#39;bucket1/videos/&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Notice that you must write the end slash (/) to inform partitioner you are providing an object prefix.</p>
<ul class="simple">
<li><p>Input data is a list of object keys. See an example in [map_reduce_cos_key.py](../../examples/map_reduce_cos_key.py):</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iterdata</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bucket1/object1&#39;</span><span class="p">,</span> <span class="s1">&#39;bucket1/object2&#39;</span><span class="p">,</span> <span class="s1">&#39;bucket1/object3&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Notice that <em>iterdata</em> must be only one of the previous 3 types. Intermingled types are not allowed. For example, you cannot set in the same <em>iterdata</em> a bucket and some object keys:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iterdata</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bucket1&#39;</span><span class="p">,</span> <span class="s1">&#39;bucket1/object2&#39;</span><span class="p">,</span> <span class="s1">&#39;bucket1/object3&#39;</span><span class="p">]</span>  <span class="c1"># Not allowed</span>
</pre></div>
</div>
<p>Once iterdata is defined, you can execute Lithops as usual, either using <em>map()</em> or <em>map_reduce()</em> calls. If you need to split the files in smaller chunks, you can set (optionally) the <em>obj_chunk_size</em> or <em>obj_chunk_number</em> parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lithops</span>

<span class="n">object_chunksize</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># 4MB</span>

<span class="n">fexec</span> <span class="o">=</span> <span class="n">lithops</span><span class="o">.</span><span class="n">FunctionExecutor</span><span class="p">()</span>
<span class="n">fexec</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">(</span><span class="n">my_map_function</span><span class="p">,</span> <span class="n">iterdata</span><span class="p">,</span> <span class="n">obj_chunk_size</span><span class="o">=</span><span class="n">object_chunksize</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">fexec</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="processing-data-from-public-urls">
<h2>Processing data from public URLs<a class="headerlink" href="#processing-data-from-public-urls" title="Permalink to this headline">¶</a></h2>
<p>For processing data from public URLs, the input data must be either a single URL or a list of URLs. As in the previous case, if you set the <em>size of the chunk</em> or the <em>number of chunks</em>, the partitioner is activated inside Lithops and it is responsible to split the objects into smaller chunks, as long as the remote storage server allows requests in chunks (ranges). If range requests are not allowed in the remote storage server, each URL is treated as a single object.</p>
<p>The <strong>obj</strong> parameter is a python class from where you can access all the information related to the object (or chunk) that the function is processing. For example, consider the following function that shows all the available attributes in <strong>obj</strong> when you are processing URLs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lithops</span>

<span class="k">def</span> <span class="nf">my_map_function</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">part</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data_byte_range</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data_stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="c1"># Do some process</span>
    <span class="k">return</span> <span class="n">partial_intersting_data</span>

<span class="k">def</span> <span class="nf">my_reduce_function</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">partial_intersting_data</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="c1"># Do some process</span>
    <span class="k">return</span> <span class="n">final_result</span>

<span class="n">iterdata</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http://myurl/my_file_1.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;http://myurl/my_file_2.csv&#39;</span><span class="p">]</span>
<span class="n">object_chunk_number</span><span class="o">=</span> <span class="mi">2</span>

<span class="n">fexec</span> <span class="o">=</span> <span class="n">lithops</span><span class="o">.</span><span class="n">FunctionExecutor</span><span class="p">()</span>
<span class="n">fexec</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">(</span><span class="n">my_map_function</span><span class="p">,</span> <span class="n">iterdata</span><span class="p">,</span> <span class="n">my_reduce_function</span><span class="p">,</span>
                 <span class="n">obj_chunk_number</span><span class="o">=</span><span class="n">object_chunk_number</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">fexec</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>
</pre></div>
</div>
<p>See a complete example in <a class="reference external" href="https://github.com/lithops-cloud/lithops/blob/master/examples/map_reduce_url.py">map_reduce_url.py</a></p>
</div>
<div class="section" id="processing-data-from-localhost-files">
<h2>Processing data from localhost files<a class="headerlink" href="#processing-data-from-localhost-files" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is only allowed when running Lithops in the localhost mode</p>
</div>
<p>For processing data from localhost files, the input data must be either a directory path, a list of directory paths, a file path a list of file paths. As in the previous cases, if you set the <em>size of the chunk</em> or the <em>number of chunks</em>, the partitioner is activated inside Lithops and it is responsible to split the objects into smaller chunks, eventually spawning one function for each generated chunk. If <em>size of the chunk</em> and <em>number of chunks</em> are not set, chunk is an entire object, so one function activation is executed for each individual object.</p>
<p>The <strong>obj</strong> parameter is a python class from where you can access all the information related to the object (or chunk) that the function is processing. For example, consider the following function that shows all the available attributes in <strong>obj</strong> when you are processing localhost files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lithops</span>

<span class="k">def</span> <span class="nf">my_map_function</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">part</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data_byte_range</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data_stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="c1"># Do some process</span>
    <span class="k">return</span> <span class="n">partial_intersting_data</span>

<span class="k">def</span> <span class="nf">my_reduce_function</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">partial_intersting_data</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="c1"># Do some process</span>
    <span class="k">return</span> <span class="n">final_result</span>

<span class="n">iterdata</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/home/user/data/my_file_1.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/user/data/my_file_2.csv&#39;</span><span class="p">]</span>
<span class="n">object_chunk_number</span><span class="o">=</span> <span class="mi">2</span>

<span class="n">fexec</span> <span class="o">=</span> <span class="n">lithops</span><span class="o">.</span><span class="n">FunctionExecutor</span><span class="p">()</span>
<span class="n">fexec</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">(</span><span class="n">my_map_function</span><span class="p">,</span> <span class="n">iterdata</span><span class="p">,</span> <span class="n">my_reduce_function</span><span class="p">,</span>
                 <span class="n">obj_chunk_number</span><span class="o">=</span><span class="n">object_chunk_number</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">fexec</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>
</pre></div>
</div>
<p>See a complete example in <a class="reference external" href="https://github.com/lithops-cloud/lithops/blob/master/examples/map_reduce_localhost.py">map_reduce_localhost.py</a>.</p>
</div>
<div class="section" id="reducer-granularity">
<h2>Reducer granularity<a class="headerlink" href="#reducer-granularity" title="Permalink to this headline">¶</a></h2>
<p>When using the <code class="docutils literal notranslate"><span class="pre">map_reduce()</span></code> API call with <code class="docutils literal notranslate"><span class="pre">obj_chunk_size</span></code> or <code class="docutils literal notranslate"><span class="pre">obj_chunk_number</span></code>, by default there will be only one reducer for all the object chunks from all the objects. Alternatively, you can spawn one reducer for each object by setting the parameter <code class="docutils literal notranslate"><span class="pre">reducer_one_per_object=True</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fexec</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">(</span><span class="n">my_map_function</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="n">my_reduce_function</span><span class="p">,</span>
                 <span class="n">obj_chunk_size</span><span class="o">=</span><span class="n">obj_chunk_size</span><span class="p">,</span> <span class="n">reducer_one_per_object</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="api_storage_os.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Storage OS API Details</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="file_chunking.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">File “chunking”</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Josep Sampé, Gil Vernik<br/>
        
            &copy; Copyright 2021, IBM Corp., Cloudlab URV.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>